<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge;chrome=1' http-equiv='X-UA-Compatible'>
    <meta content='width=device-width, initial-scale=1, user-scalable=yes' name='viewport'>
    <meta content='#9CE8AC' name='theme-color'>
    <title>
      PE-Notes  - Validating hash params in ruby
    </title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
    <link href="/stylesheets/application-24cc418f.css" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/mobile-b135630e.css" rel="stylesheet" type="text/css" media="only screen and (max-device-width : 640px), screen and (max-width : 640px)" />
  </head>
  <body>
    <header>
      <div class='inner'><a href='/'><h2>Pavel's Notes</h2>
        <br>
        <h4>About programming in Ruby, Javascript, D</h4></a></div>
    </header>
    <div class='page-wrapper'>
      <div id='main' role='main'>
        <article class='blog-post'>
          <h2 class='title'>
            Validating hash params in ruby
            <br>
            <span class='date'>Jan 27, 2015</span>
          </h2>
          <p>If compare many arguments vs &ldquo;options&rdquo; hash, I usually choose options hash. And I often face problems when I pass wrong key name or what not supported.</p>
          
          <p><code>ActiveSupport</code> already have <a href="http://apidock.com/rails/Hash/assert_valid_keys">Hash#assert<em>valid</em>keys</a>, I added one more method <code>assert_required_keys</code>:</p>
          <pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Hash</span>&#x000A;  <span class="k">def</span> <span class="nf">assert_required_keys</span><span class="p">(</span><span class="o">*</span><span class="n">keys</span><span class="p">)</span>&#x000A;    <span class="n">keys</span><span class="p">.</span><span class="nf">flatten</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span>&#x000A;      <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Required key: </span><span class="si">#{</span><span class="n">key</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span> <span class="k">unless</span> <span class="n">has_key?</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre>
          
          <p>Here is my solution to validate hash keys:</p>
          <pre class="highlight ruby"><code><span class="k">module</span> <span class="nn">ValidateOptions</span>&#x000A;  <span class="k">def</span> <span class="nf">validate_options!</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>&#x000A;    <span class="n">options</span><span class="p">[</span><span class="ss">:optional</span><span class="p">]</span> <span class="o">||=</span> <span class="p">[]</span>&#x000A;    <span class="n">options</span><span class="p">[</span><span class="ss">:required</span><span class="p">]</span> <span class="o">||=</span> <span class="p">[]</span>&#x000A;&#x000A;    <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="nf">deep_symbolize_keys</span>&#x000A;    <span class="n">params</span><span class="p">.</span><span class="nf">assert_required_keys</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="ss">:required</span><span class="p">])</span>&#x000A;    <span class="n">params</span><span class="p">.</span><span class="nf">assert_valid_keys</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="ss">:required</span><span class="p">]</span> <span class="o">+</span> <span class="n">options</span><span class="p">[</span><span class="ss">:optional</span><span class="p">])</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre>
          
          <p>Usage example:</p>
          <pre class="highlight ruby"><code><span class="kp">include</span> <span class="no">ValidateOptions</span>&#x000A;&#x000A;<span class="k">def</span> <span class="nf">method_with_options</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>&#x000A;  <span class="n">validate_options!</span><span class="p">(</span><span class="n">options</span><span class="p">,</span>&#x000A;    <span class="ss">required: </span><span class="p">[</span><span class="ss">:order_id</span><span class="p">,</span> <span class="ss">:subject</span><span class="p">,</span> <span class="ss">:from</span><span class="p">,</span> <span class="ss">:to</span><span class="p">,</span> <span class="ss">:text_body</span><span class="p">,</span> <span class="ss">:html_body</span><span class="p">],</span>&#x000A;    <span class="ss">optional: </span><span class="p">[</span><span class="ss">:cc</span><span class="p">,</span> <span class="ss">:bcc</span><span class="p">,</span> <span class="ss">:template_name</span><span class="p">]</span>&#x000A;  <span class="p">)</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre>
          <div id="disqus_thread"></div>
          <script type="text/javascript">
          //<![CDATA[
                            var disqus_shortname = 'pe-notes';
                    
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          //]]>
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          
        </article>
      </div>
      <aside>
        <h2>Recent Articles</h2>
        <ol>
          <li>
            <a href="/2015/04/17/testing-high-concurrency-http-server.html">Testing high concurrency http server</a>
            <br>
            <span class='date'>Apr 17, 2015</span>
          </li>
          <li>
            <a href="/2015/03/02/synchronous-javascript-with-fibers.html">Synchronous Javascript with fibers</a>
            <br>
            <span class='date'>Mar  2, 2015</span>
          </li>
          <li>
            <a href="/2015/01/29/convert-mysql-database-to-postgresql.html">Convert mysql database to postgresql</a>
            <br>
            <span class='date'>Jan 29, 2015</span>
          </li>
          <li>
            <a href="/2015/01/27/validating-hash-params-in-ruby.html">Validating hash params in ruby</a>
            <br>
            <span class='date'>Jan 27, 2015</span>
          </li>
          <li>
            <a href="/2015/01/14/handle-exceptions-in-d.html">Handle exceptions in D</a>
            <br>
            <span class='date'>Jan 14, 2015</span>
          </li>
          <li>
            <a href="/2015/01/13/anonymous-functions-in-d.html">Anonymous functions in D</a>
            <br>
            <span class='date'>Jan 13, 2015</span>
          </li>
          <li>
            <a href="/2014/10/28/itunes-12-blue-icon.html">iTunes 12 blue icon</a>
            <br>
            <span class='date'>Oct 28, 2014</span>
          </li>
          <li>
            <a href="/2014/09/29/convert-ruby-time-to-server-timezone.html">Convert ruby time to server timezone</a>
            <br>
            <span class='date'>Sep 29, 2014</span>
          </li>
          <li>
            <a href="/2014/08/26/node-js-standart-libs-auto-require.html">Node.js standart libs auto-require</a>
            <br>
            <span class='date'>Aug 26, 2014</span>
          </li>
          <li>
            <a href="/2014/07/16/continuous-testing-for-d.html">Continuous testing for D</a>
            <br>
            <span class='date'>Jul 16, 2014</span>
          </li>
        </ol>
      </aside>
    </div>
  </body>
</html>
